<!DOCTYPE html>
<html lang="english">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>RPCx Component | go-dandelion</title><meta name="description" content="一个golang脚手架工具">
    <link rel="preload" href="/assets/style-bfda533b.css" as="style"><link rel="stylesheet" href="/assets/style-bfda533b.css">
    <link rel="modulepreload" href="/assets/app-304f5532.js"><link rel="modulepreload" href="/assets/rpc.html-b9dd18eb.js"><link rel="modulepreload" href="/assets/rpc.html-7d152d72.js"><link rel="prefetch" href="/assets/index.html-165a130f.js" as="script"><link rel="prefetch" href="/assets/index.html-06a8ea50.js" as="script"><link rel="prefetch" href="/assets/about.html-42d681ff.js" as="script"><link rel="prefetch" href="/assets/baseconfig.html-8ad13111.js" as="script"><link rel="prefetch" href="/assets/callme.html-edff5038.js" as="script"><link rel="prefetch" href="/assets/dir.html-690b1bcb.js" as="script"><link rel="prefetch" href="/assets/joinus.html-f62db3b2.js" as="script"><link rel="prefetch" href="/assets/started.html-c4137f90.js" as="script"><link rel="prefetch" href="/assets/database.html-1010a0e5.js" as="script"><link rel="prefetch" href="/assets/http.html-48f5dd7b.js" as="script"><link rel="prefetch" href="/assets/other.html-212f0698.js" as="script"><link rel="prefetch" href="/assets/plugins.html-7e8a81ee.js" as="script"><link rel="prefetch" href="/assets/index.html-c70122b8.js" as="script"><link rel="prefetch" href="/assets/index.html-62b87b12.js" as="script"><link rel="prefetch" href="/assets/index.html-a7d1cf67.js" as="script"><link rel="prefetch" href="/assets/about.html-97925c29.js" as="script"><link rel="prefetch" href="/assets/baseconfig.html-e1d50efe.js" as="script"><link rel="prefetch" href="/assets/callme.html-2b5d5fce.js" as="script"><link rel="prefetch" href="/assets/dir.html-006f54e9.js" as="script"><link rel="prefetch" href="/assets/joinus.html-74bd3c01.js" as="script"><link rel="prefetch" href="/assets/started.html-1ac0bace.js" as="script"><link rel="prefetch" href="/assets/database.html-f751a302.js" as="script"><link rel="prefetch" href="/assets/http.html-f62cc8f2.js" as="script"><link rel="prefetch" href="/assets/other.html-c2184e86.js" as="script"><link rel="prefetch" href="/assets/plugins.html-305f4bf7.js" as="script"><link rel="prefetch" href="/assets/rpc.html-bbf9f246.js" as="script"><link rel="prefetch" href="/assets/404.html-71ed4891.js" as="script"><link rel="prefetch" href="/assets/index.html-0f2da151.js" as="script"><link rel="prefetch" href="/assets/index.html-09b40549.js" as="script"><link rel="prefetch" href="/assets/about.html-9758a565.js" as="script"><link rel="prefetch" href="/assets/baseconfig.html-0da387b0.js" as="script"><link rel="prefetch" href="/assets/callme.html-509506a9.js" as="script"><link rel="prefetch" href="/assets/dir.html-b1b40030.js" as="script"><link rel="prefetch" href="/assets/joinus.html-11a291f6.js" as="script"><link rel="prefetch" href="/assets/started.html-d5f6cf20.js" as="script"><link rel="prefetch" href="/assets/database.html-1297c10d.js" as="script"><link rel="prefetch" href="/assets/http.html-7f3e1e36.js" as="script"><link rel="prefetch" href="/assets/other.html-621fb4a5.js" as="script"><link rel="prefetch" href="/assets/plugins.html-41a75007.js" as="script"><link rel="prefetch" href="/assets/index.html-5eef61e1.js" as="script"><link rel="prefetch" href="/assets/index.html-5688209f.js" as="script"><link rel="prefetch" href="/assets/index.html-ccd1c687.js" as="script"><link rel="prefetch" href="/assets/about.html-c5b05f84.js" as="script"><link rel="prefetch" href="/assets/baseconfig.html-f0bdf985.js" as="script"><link rel="prefetch" href="/assets/callme.html-d54df126.js" as="script"><link rel="prefetch" href="/assets/dir.html-deaedfda.js" as="script"><link rel="prefetch" href="/assets/joinus.html-a24c4823.js" as="script"><link rel="prefetch" href="/assets/started.html-a59f5c60.js" as="script"><link rel="prefetch" href="/assets/database.html-7d0cdcd7.js" as="script"><link rel="prefetch" href="/assets/http.html-2f0cd1db.js" as="script"><link rel="prefetch" href="/assets/other.html-8385f7f3.js" as="script"><link rel="prefetch" href="/assets/plugins.html-5155def2.js" as="script"><link rel="prefetch" href="/assets/rpc.html-83fcebea.js" as="script"><link rel="prefetch" href="/assets/404.html-82f7839a.js" as="script"><link rel="prefetch" href="/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="go-dandelion"><span class="site-name can-hide">go-dandelion</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/guide/about.md" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="project"><span class="title">project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="project"><span class="title">project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/gly-hub/go-dandelion" rel="noopener noreferrer" target="_blank" aria-label="go-dandelion"><!--[--><!--]--> go-dandelion <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/gly-hub/go-admin-example" rel="noopener noreferrer" target="_blank" aria-label="go-admin-example"><!--[--><!--]--> go-admin-example <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guide/upgrade/rpc.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guide/upgrade/rpc.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/gly-hub/go-dandelion-doc" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search Documentation"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search Documentation</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/guide/about.md" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="project"><span class="title">project</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="project"><span class="title">project</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/gly-hub/go-dandelion" rel="noopener noreferrer" target="_blank" aria-label="go-dandelion"><!--[--><!--]--> go-dandelion <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/gly-hub/go-admin-example" rel="noopener noreferrer" target="_blank" aria-label="go-admin-example"><!--[--><!--]--> go-admin-example <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guide/upgrade/rpc.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guide/upgrade/rpc.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/gly-hub/go-dandelion-doc" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">guide <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/guide/about.html" class="sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----></li><li><a href="/guide/started.html" class="sidebar-item" aria-label="Quick Build"><!--[--><!--]--> Quick Build <!--[--><!--]--></a><!----></li><li><a href="/guide/baseconfig.html" class="sidebar-item" aria-label="Basic Configuration"><!--[--><!--]--> Basic Configuration <!--[--><!--]--></a><!----></li><li><a href="/guide/dir.html" class="sidebar-item" aria-label="Directory Structure"><!--[--><!--]--> Directory Structure <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">upgrade <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/upgrade/rpc.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="RPCx Component"><!--[--><!--]--> RPCx Component <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/upgrade/rpc.html#_1-what-is-rpc" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. What is RPC?"><!--[--><!--]--> 1. What is RPC? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/upgrade/rpc.html#_2-what-is-rpcx" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.What is RPCx?"><!--[--><!--]--> 2.What is RPCx? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/upgrade/rpc.html#_3-how-to-use-rpcx" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. How to use RPCx"><!--[--><!--]--> 3. How to use RPCx <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/upgrade/rpc.html#_3-1-service-discovery" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 Service Discovery"><!--[--><!--]--> 3.1 Service Discovery <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/upgrade/rpc.html#_3-2-service-governance" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 Service Governance"><!--[--><!--]--> 3.2 Service Governance <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/upgrade/rpc.html#_3-3-server" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 Server"><!--[--><!--]--> 3.3 Server <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/upgrade/rpc.html#_3-4-client" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 Client"><!--[--><!--]--> 3.4 Client <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/guide/upgrade/http.html" class="sidebar-item" aria-label="HTTP Component"><!--[--><!--]--> HTTP Component <!--[--><!--]--></a><!----></li><li><a href="/guide/upgrade/database.html" class="sidebar-item" aria-label="Database and Caching"><!--[--><!--]--> Database and Caching <!--[--><!--]--></a><!----></li><li><a href="/guide/upgrade/other.html" class="sidebar-item" aria-label="Other Components"><!--[--><!--]--> Other Components <!--[--><!--]--></a><!----></li><li><a href="/guide/upgrade/plugins.html" class="sidebar-item" aria-label="plugins"><!--[--><!--]--> plugins <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">other <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/guide/joinus.html" class="sidebar-item" aria-label="Join Us"><!--[--><!--]--> Join Us <!--[--><!--]--></a><!----></li><li><a href="/guide/callme.html" class="sidebar-item" aria-label="Project Showcase"><!--[--><!--]--> Project Showcase <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="rpc-component" tabindex="-1"><a class="header-anchor" href="#rpc-component" aria-hidden="true">#</a> RPC Component</h1><h2 id="_1-what-is-rpc" tabindex="-1"><a class="header-anchor" href="#_1-what-is-rpc" aria-hidden="true">#</a> 1. What is RPC?</h2><div class="theorem"><p class="title">Remote Procedure Call</p><p>In distributed computing, a remote procedure call (RPC) is when a computer program causes a procedure (subroutine) to execute in a different address space (commonly on another computer on a shared network), which is written as if it were a normal (local) procedure call, without the programmer explicitly writing the details for the remote interaction. That is, the programmer writes essentially the same code whether the subroutine is local to the executing program, or remote. This is a form of client–server interaction (caller is client, executor is server), typically implemented via a request–response message-passing system. In the object-oriented programming paradigm, RPCs are represented by remote method invocation (RMI). The RPC model implies a level of location transparency, namely that calling procedures are largely the same whether they are local or remote, but usually, they are not identical, so local calls can be distinguished from remote calls. Remote calls are usually orders of magnitude slower and less reliable than local calls, so distinguishing them is important.</p><p>RPCs are a form of inter-process communication (IPC), in that different processes have different address spaces: if on the same host machine, they have distinct virtual address spaces, even though the physical address space is the same; while if they are on different hosts, the physical address space is different. Many different (often incompatible) technologies have been used to implement the concept.</p><div class="custom-container right"><p>Source <a href="https://en.wikipedia.org/wiki/Remote_procedure_call" target="_blank" rel="noopener noreferrer">wiki<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div></div><h2 id="_2-what-is-rpcx" tabindex="-1"><a class="header-anchor" href="#_2-what-is-rpcx" aria-hidden="true">#</a> 2.What is RPCx?</h2><div class="theorem"><p class="title">RPCx</p><p>RPCx is a distributed Go language RPC framework that supports multiple service discovery methods, such as ZooKeeper, etcd, and Consul. It is one of the fastest RPC frameworks available.</p><div class="custom-container right"><p>Source <a href="https://doc.rpcx.io/" target="_blank" rel="noopener noreferrer">rpcx<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div></div><ul><li>Easy to use: Easy to learn, develop, integrate, deploy, and monitor.</li><li>High performance: Significantly outperforms frameworks like <code>Dubbo</code>, <code>Motan</code>, and <code>Thrift</code>, and offers twice the performance of <code>gRPC</code>.</li><li>Cross-platform and cross-language: Can be easily deployed on Windows/Linux/MacOS and supports various programming languages.</li><li>Service discovery: In addition to direct connections, it supports service discovery with <code>ZooKeeper</code>, <code>etcd</code>, <code>Consul</code>, <code>mDNS</code>, and more.</li><li>Service governance: Supports <code>failover</code>, <code>failfast</code>, <code>failtry</code>, backup, and other failure modes, as well as <code>random</code>, <code>round-robin</code>, <code>weighted</code>, <code>network quality</code>, <code>consistent hashing</code>, and <code>geographic routing algorithms</code>.</li></ul><h2 id="_3-how-to-use-rpcx" tabindex="-1"><a class="header-anchor" href="#_3-how-to-use-rpcx" aria-hidden="true">#</a> 3. How to use RPCx</h2><div class="custom-container tip"><p class="custom-container-title">Note</p><p>The framework integrates the RPCx component, and you only need to configure the RPC server and client settings in the configuration file.</p></div><h3 id="_3-1-service-discovery" tabindex="-1"><a class="header-anchor" href="#_3-1-service-discovery" aria-hidden="true">#</a> 3.1 Service Discovery</h3><p>Refer to the actual project development. The framework only integrates three commonly used service discovery methods: <code>ZooKeeper</code>, <code>etcd</code>, and <code>Consul</code>.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
	ETCD RegisterPluginType <span class="token operator">=</span> <span class="token string">&quot;etcd&quot;</span>
	ZK   RegisterPluginType <span class="token operator">=</span> <span class="token string">&quot;zookeeper&quot;</span>
	Con  RegisterPluginType <span class="token operator">=</span> <span class="token string">&quot;consul&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-service-governance" tabindex="-1"><a class="header-anchor" href="#_3-2-service-governance" aria-hidden="true">#</a> 3.2 Service Governance</h3><p>Service governance is a broad concept that generally refers to providing reliable measures to ensure the proper functioning of a system, independent of business logic. For common failure scenarios in microservice environments, it provides safeguards such as flow control, load balancing, retrying, and isolation.</p><h4 id="_3-2-1-basic-configuration" tabindex="-1"><a class="header-anchor" href="#_3-2-1-basic-configuration" aria-hidden="true">#</a> 3.2.1 Basic Configuration</h4><div class="custom-container tip"><p class="custom-container-title">Note</p><p>The basic configuration of the service can be customized and referred to in <code>server/rpcx/client.go:101</code>. If not customized, the default configuration is used.</p></div><p>Default configuration:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">option</span><span class="token punctuation">(</span><span class="token punctuation">)</span> client<span class="token punctuation">.</span>Option <span class="token punctuation">{</span>
	opt <span class="token operator">:=</span> client<span class="token punctuation">.</span>Option<span class="token punctuation">{</span>
		Retries<span class="token punctuation">:</span>            <span class="token number">10</span><span class="token punctuation">,</span>               <span class="token comment">// Retry times</span>
		TimeToDisallow<span class="token punctuation">:</span>     time<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>      <span class="token comment">// The failed server will not be retried for 30 seconds</span>
		ConnectTimeout<span class="token punctuation">:</span>     <span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>  <span class="token comment">// Connection timeout</span>
		IdleTimeout<span class="token punctuation">:</span>        <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> <span class="token comment">// Maximum idle time</span>
		BackupLatency<span class="token punctuation">:</span>      <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">,</span> <span class="token comment">// ackup mode interval</span>
		GenBreaker<span class="token punctuation">:</span>         breaker<span class="token punctuation">,</span> <span class="token comment">// fuse</span>
		SerializeType<span class="token punctuation">:</span>      protocol<span class="token punctuation">.</span>MsgPack<span class="token punctuation">,</span> <span class="token comment">// serialize type</span>
		CompressType<span class="token punctuation">:</span>       protocol<span class="token punctuation">.</span>None<span class="token punctuation">,</span> <span class="token comment">// compress type</span>
		TCPKeepAlivePeriod<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span> 
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> opt
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Custom</strong></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> opt

<span class="token comment">// Circuit breaker opens when the number of failures reaches 5 within 100 milliseconds</span>
<span class="token keyword">func</span> <span class="token function">customBreak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> client<span class="token punctuation">.</span>Breaker <span class="token punctuation">{</span>
	<span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">NewConsecCircuitBreaker</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CustomOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span> client<span class="token punctuation">.</span>Option <span class="token punctuation">{</span>
	opt <span class="token operator">:=</span> client<span class="token punctuation">.</span>Option<span class="token punctuation">{</span>
		Retries<span class="token punctuation">:</span>            <span class="token number">5</span><span class="token punctuation">,</span>               <span class="token comment">// Retry times</span>
		TimeToDisallow<span class="token punctuation">:</span>     time<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>      <span class="token comment">// Retry is not allowed within 30 seconds</span>
		ConnectTimeout<span class="token punctuation">:</span>     <span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>  <span class="token comment">// Connection timeout</span>
		IdleTimeout<span class="token punctuation">:</span>        <span class="token number">30</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> <span class="token comment">// Maximum idle time</span>
		BackupLatency<span class="token punctuation">:</span>      <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">,</span> <span class="token comment">// Backup mode interval</span>
		GenBreaker<span class="token punctuation">:</span>         customBreak<span class="token punctuation">,</span> <span class="token comment">// Circuit breaker</span>
		SerializeType<span class="token punctuation">:</span>      protocol<span class="token punctuation">.</span>MsgPack<span class="token punctuation">,</span> <span class="token comment">// Serialization type</span>
		CompressType<span class="token punctuation">:</span>       protocol<span class="token punctuation">.</span>None<span class="token punctuation">,</span> <span class="token comment">// Compression type</span>
		TCPKeepAlivePeriod<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span> <span class="token comment">// TCP keep-alive time</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> opt
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Register in <code>cmd/api/server.go</code>.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>

	<span class="token comment">// Register</span>
	rpcx<span class="token punctuation">.</span><span class="token function">CustomOptions</span><span class="token punctuation">(</span>opt<span class="token punctuation">.</span>CustomOption<span class="token punctuation">)</span>

	<span class="token comment">// Application initialization</span>
	application<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-failure-mode" tabindex="-1"><a class="header-anchor" href="#_3-2-2-failure-mode" aria-hidden="true">#</a> 3.2.2 Failure Mode</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    <span class="token comment">// FailFast returns an error immediately if the call fails.</span>
    FailFast FailRetryModel <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment">// FailOver retries other servers if the call fails.</span>
    FailOver
    <span class="token comment">// FailTry retries the current server if the call fails.</span>
    FailTry
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-load-balancing" tabindex="-1"><a class="header-anchor" href="#_3-2-3-load-balancing" aria-hidden="true">#</a> 3.2.3 Load Balancing</h4><p>The framework integrates several commonly used load balancing methods.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    <span class="token comment">// Random selects a random server.</span>
    Random BalanceModel <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment">// RoundRobin uses round-robin algorithm to select servers.</span>
    RoundRobin
    <span class="token comment">// ConsistentHash uses consistent hashing algorithm.</span>
    ConsistentHash
    <span class="token comment">// NetworkQuality selects servers based on network quality.</span>
    NetworkQuality
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-server" tabindex="-1"><a class="header-anchor" href="#_3-3-server" aria-hidden="true">#</a> 3.3 Server</h3><h4 id="_3-3-1-server-startup-and-registration" tabindex="-1"><a class="header-anchor" href="#_3-3-1-server-startup-and-registration" aria-hidden="true">#</a> 3.3.1 Server Startup and Registration</h4><p>In <code>application/rpcserver.go</code>, provide the <code>RpcServer</code> method to start the RPC server.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">RpcServer</span><span class="token punctuation">(</span>handler <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> auth <span class="token operator">...</span>rpcx<span class="token punctuation">.</span>AuthFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	rpcServer<span class="token punctuation">,</span> err <span class="token operator">=</span> rpcx<span class="token punctuation">.</span><span class="token function">NewRPCServer</span><span class="token punctuation">(</span>rpcx<span class="token punctuation">.</span>ServerConfig<span class="token punctuation">{</span>
		ServerName<span class="token punctuation">:</span>      config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcServer<span class="token punctuation">.</span>ServerName<span class="token punctuation">,</span>
		Addr<span class="token punctuation">:</span>            fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s:%d&quot;</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcServer<span class="token punctuation">.</span>Port<span class="token punctuation">)</span><span class="token punctuation">,</span>
		BasePath<span class="token punctuation">:</span>        config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcServer<span class="token punctuation">.</span>BasePath<span class="token punctuation">,</span>
		RegisterPlugin<span class="token punctuation">:</span>  rpcx<span class="token punctuation">.</span><span class="token function">RegisterPluginType</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcServer<span class="token punctuation">.</span>RegisterPlugin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		RegisterServers<span class="token punctuation">:</span> config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcServer<span class="token punctuation">.</span>RegisterServers<span class="token punctuation">,</span>
		Handle<span class="token punctuation">:</span>          handler<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		rpcServer<span class="token punctuation">.</span><span class="token function">RegisterAuthFunc</span><span class="token punctuation">(</span>auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
    <span class="token operator">...</span>
	rpcServer<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-authentication-component" tabindex="-1"><a class="header-anchor" href="#_3-3-2-authentication-component" aria-hidden="true">#</a> 3.3.2 Authentication Component</h4><p>In <code>rpcx/server.go</code>, <code>RegisterAuthFunc</code> interface is provided to customize the authentication component.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> AuthFunc <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Example</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TokenAuth</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> token <span class="token operator">==</span> <span class="token string">&quot;admin&quot;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;token error&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="_3-3-3-logging-middleware" tabindex="-1"><a class="header-anchor" href="#_3-3-3-logging-middleware" aria-hidden="true">#</a> 3.3.3 Logging Middleware</h4><p>In <code>rpcx/middleware.go</code>, <code>ServerLoggerPlugin</code> class is provided for request tracing and logging.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> ServerLoggerPlugin <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>ServerLoggerPlugin<span class="token punctuation">)</span> <span class="token function">PreHandleRequest</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>protocol<span class="token punctuation">.</span>Message<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	logger<span class="token punctuation">.</span><span class="token function">SetRequestId</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Metadata<span class="token punctuation">[</span><span class="token string">&quot;request_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	traceId <span class="token operator">:=</span> r<span class="token punctuation">.</span>Metadata<span class="token punctuation">[</span><span class="token string">&quot;span_trace_id&quot;</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> traceId <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		span<span class="token punctuation">,</span> spanTraceId<span class="token punctuation">,</span> err <span class="token operator">:=</span> telemetry<span class="token punctuation">.</span><span class="token function">StartSpan</span><span class="token punctuation">(</span><span class="token string">&quot;RpcCall&quot;</span><span class="token punctuation">,</span> traceId<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> opentracing<span class="token punctuation">.</span><span class="token function">StartTime</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			telemetry<span class="token punctuation">.</span><span class="token function">SpanSetTag</span><span class="token punctuation">(</span>span<span class="token punctuation">,</span> <span class="token string">&quot;request_id&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Metadata<span class="token punctuation">[</span><span class="token string">&quot;request_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			telemetry<span class="token punctuation">.</span><span class="token function">SpanSetTag</span><span class="token punctuation">(</span>span<span class="token punctuation">,</span> <span class="token string">&quot;call_method&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>ServiceMethod<span class="token punctuation">)</span>
			telemetry<span class="token punctuation">.</span><span class="token function">SetSpanTraceId</span><span class="token punctuation">(</span>spanTraceId<span class="token punctuation">)</span>
			spanMap<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span>goid<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> span<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;client: %s, server: %v, func: %s, params: %s&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Metadata<span class="token punctuation">[</span><span class="token string">&quot;client_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>ServicePath<span class="token punctuation">,</span> r<span class="token punctuation">.</span>ServiceMethod<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Metadata<span class="token punctuation">[</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>ServerLoggerPlugin<span class="token punctuation">)</span> <span class="token function">PostWriteResponse</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>protocol<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> res <span class="token operator">*</span>protocol<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	logger<span class="token punctuation">.</span><span class="token function">DeleteRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> span<span class="token punctuation">,</span> ok <span class="token operator">:=</span> spanMap<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>goid<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
		telemetry<span class="token punctuation">.</span><span class="token function">FinishSpan</span><span class="token punctuation">(</span>span<span class="token punctuation">.</span><span class="token punctuation">(</span>opentracing<span class="token punctuation">.</span>Span<span class="token punctuation">)</span><span class="token punctuation">)</span>
		spanMap<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>goid<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-client" tabindex="-1"><a class="header-anchor" href="#_3-4-client" aria-hidden="true">#</a> 3.4 Client</h3><h4 id="_3-4-1-client-pool-initialization" tabindex="-1"><a class="header-anchor" href="#_3-4-1-client-pool-initialization" aria-hidden="true">#</a> 3.4.1 Client Pool Initialization</h4><p>In <code>application/rpcserver.go</code>, provide the <code>initRpcClient</code> method to initialize the RPC client connection pool. This method is automatically triggered and will initialize if there is a <code>rpcClient</code> configuration.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">initRpcClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    client<span class="token punctuation">,</span> err <span class="token operator">:=</span> rpcx<span class="token punctuation">.</span><span class="token function">NewRPCClient</span><span class="token punctuation">(</span>rpcx<span class="token punctuation">.</span>ClientConfig<span class="token punctuation">{</span>
        ClientName<span class="token punctuation">:</span>      config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>ClientName<span class="token punctuation">,</span>
        BasePath<span class="token punctuation">:</span>        config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>BasePath<span class="token punctuation">,</span>
        RegisterPlugin<span class="token punctuation">:</span>  rpcx<span class="token punctuation">.</span><span class="token function">RegisterPluginType</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>RegisterPlugin<span class="token punctuation">)</span><span class="token punctuation">,</span>
        RegisterServers<span class="token punctuation">:</span> config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>RegisterServers<span class="token punctuation">,</span>
        FailRetryModel<span class="token punctuation">:</span>  rpcx<span class="token punctuation">.</span><span class="token function">FailRetryModel</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>FailRetryModel<span class="token punctuation">)</span><span class="token punctuation">,</span>
        BalanceModel<span class="token punctuation">:</span>    rpcx<span class="token punctuation">.</span><span class="token function">BalanceModel</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>BalanceModel<span class="token punctuation">)</span><span class="token punctuation">,</span>
        PoolSize<span class="token punctuation">:</span>        config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>PoolSize<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    rpcClient <span class="token operator">=</span> <span class="token operator">&amp;</span>RpcClient<span class="token punctuation">{</span>
        ClientName<span class="token punctuation">:</span> config<span class="token punctuation">.</span>Conf<span class="token punctuation">.</span>RpcClient<span class="token punctuation">.</span>ClientName<span class="token punctuation">,</span>
        clientPool<span class="token punctuation">:</span> client<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2-custom-header-handling-function" tabindex="-1"><a class="header-anchor" href="#_3-4-2-custom-header-handling-function" aria-hidden="true">#</a> 3.4.2 Custom Header Handling Function</h4><p>In <code>application/rpcserver.go</code>, the <code>RegisterHeaderFunc</code> interface is provided to customize the header handling function. This method is used to add parameters that need to be passed through the context to the RPC request metadata.</p><div class="custom-container tip"><p class="custom-container-title">Example</p><p>Register the corresponding function in the application <code>cmd/api/server.go</code>.</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token comment">// Register header context chain</span>
    application<span class="token punctuation">.</span><span class="token function">RegisterHeaderFunc</span><span class="token punctuation">(</span>HeaderFunc<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">HeaderFunc</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>routing<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> data <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the username</span>
    data<span class="token punctuation">[</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span>
    <span class="token operator">...</span>
    <span class="token keyword">return</span> data
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="_3-4-3-remote-invocation-by-client" tabindex="-1"><a class="header-anchor" href="#_3-4-3-remote-invocation-by-client" aria-hidden="true">#</a> 3.4.3 Remote Invocation by Client</h4><p>In <code>application/rpcserver.go</code>, the <code>RpcCall</code> and <code>SRpcCall</code> methods are provided for remote invocation. These methods integrate parameter parsing, request tracing, header processing, and other functions to handle the RPC response parameters.</p><div class="custom-container tip"><p class="custom-container-title">Example of RpcCall</p><p>After receiving the response from the <code>RpcCall</code> method, you need to handle the HTTP response manually. (The HTTP response structure and methods can be customized.)</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>AuthController<span class="token punctuation">)</span> <span class="token function">GetSystemInfo</span><span class="token punctuation">(</span>c <span class="token operator">*</span>routing<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token punctuation">(</span>
        req  <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>auth2<span class="token punctuation">.</span>SystemInfoSearch<span class="token punctuation">)</span>
        resp <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>auth2<span class="token punctuation">.</span>SystemInfoResp<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    err <span class="token operator">:=</span> application<span class="token punctuation">.</span><span class="token function">RpcCall</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> rpcserver<span class="token punctuation">.</span>AuthServer<span class="token punctuation">,</span> rpcserver<span class="token punctuation">.</span>AuthFuncSystemInfo<span class="token punctuation">,</span> req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container tip"><p class="custom-container-title">Example of SRpcCall</p><p>After receiving the response from the <code>SRpcCall</code> method, the HTTP response method is automatically invoked. (The HTTP response method is provided by the system and does not support customization.)</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>AuthController<span class="token punctuation">)</span> <span class="token function">Login</span><span class="token punctuation">(</span>c <span class="token operator">*</span>routing<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> application<span class="token punctuation">.</span><span class="token function">SRpcCall</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> rpcserver<span class="token punctuation">.</span>AuthServer<span class="token punctuation">,</span> rpcserver<span class="token punctuation">.</span>AuthFuncLogin<span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>auth2<span class="token punctuation">.</span>LoginParams<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">new</span><span class="token punctuation">(</span>auth2<span class="token punctuation">.</span>LoginResp<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/gly-hub/go-dandelion-doc/edit/main/docs/guide/upgrade/rpc.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: fangao@staruniongame.com">fangao</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/guide/upgrade/http.html" class="" aria-label="HTTP Component"><!--[--><!--]--> HTTP Component <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-304f5532.js" defer></script>
  </body>
</html>
